$.extend($.importexport.plugins,{generator:{$form:null,progress:false,ajax_pull:{},data:{params:{}},debug:{memory:0,memory_avg:0},init:function(b){$.shop.trace("init data",b);this.$form=$("#s-plugin-generator");$.extend(this.data,b)},action:function(){},onInit:function(){$.importexport.products.init(this.$form);this.$form.unbind("submit.generator").bind("submit.generator",function(b){$.shop.trace("submit.generator "+b.namespace,b);$.importexport.plugins.generator.generatorHandler(this);return false})},actionHandler:function(b){$.shop.trace("actionHadler arg",b);return false},select:function(f,d){var e=$(f).find("span.name").text();$("#s-plugin-generator-cat").val(e);$("#s-plugin-generator-catid").val(d)},generatorHandler:function(g){var f=this;f.progress=true;f.form=$(g);var h=f.form.serialize();var e=$(g).attr("action");$.shop.trace("elm",g);f.form.find(".errormsg").text("");f.form.find(":input").prop("disabled",true);f.form.find(":submit").hide();f.form.find(".progressbar .progressbar-inner").css("width","0");f.form.find(".progressbar").show();f.form.find("#plugin-generator-report").hide();$.ajax({url:e,data:h,dataType:"json",type:"post",success:function(a){if(a.error){f.form.find(":input").prop("disabled",false);f.form.find(":submit").show();f.form.find(".js-progressbar-container").hide();f.form.find(".shop-ajax-status-loading").remove();f.progress=false;f.form.find(".errormsg").text(a.error)}else{f.form.find(".progressbar").attr("title","0.00%");f.form.find(".progressbar-description").text("0.00%");f.form.find(".js-progressbar-container").show();f.ajax_pull[a.processId]=[];f.ajax_pull[a.processId].push(setTimeout(function(){$.wa.errorHandler=function(b){return !((b.status>=500)||(b.status==0))};f.progressHandler(e,a.processId,a)},100));f.ajax_pull[a.processId].push(setTimeout(function(){f.progressHandler(e,a.processId,null)},2000))}},error:function(){f.form.find(":input").attr("disabled",false);f.form.find(":submit").show();f.form.find(".js-progressbar-container").hide();f.form.find(".shop-ajax-status-loading").remove();f.form.find(".progressbar").hide()}})},progressHandler:function(v,x,r){var n=$.importexport.plugins.generator;var s;if(r&&r.ready){$.wa.errorHandler=null;var t;while(t=n.ajax_pull[x].pop()){if(t){clearTimeout(t)}}s=n.form.find(".progressbar .progressbar-inner");s.css({width:"100%"});$.shop.trace("cleanup",r.processId);$.ajax({url:v,data:{processId:r.processId,cleanup:1},dataType:"json",type:"post",success:function(a){$.shop.trace("report",a);n.form.find(".js-progressbar-container").hide();var b=$("#plugin-generator-report");b.show();if(a.report){b.find(".value:first").html(a.report)}n.form.find(":input").prop("disabled",false);n.form.find(":submit").show()}})}else{if(r&&r.error){n.form.find(":input").attr("disabled",false);n.form.find(":submit").show();n.form.find(".js-progressbar-container").hide();n.form.find(".shop-ajax-status-loading").remove();n.form.find(".progressbar").hide();n.form.find(".errormsg").text(r.error)}else{var p;if(r&&(typeof(r.progress)!="undefined")){s=n.form.find(".progressbar .progressbar-inner");var w=parseFloat(r.progress.replace(/,/,"."));s.animate({width:w+"%"});n.debug.memory=Math.max(0,n.debug.memory,parseFloat(r.memory)||0);n.debug.memory_avg=Math.max(0,n.debug.memory_avg,parseFloat(r.memory_avg)||0);var o="Memory usage: "+n.debug.memory_avg+"/"+n.debug.memory+"MB";o+=" ("+(1+r.stage_num)+"/"+(0+r.stage_count)+")";var m=r.progress;s.parents(".progressbar").attr("title",r.progress);p=n.form.find(".progressbar-description");p.text(m);p.attr("title",o)}if(r&&(typeof(r.warning)!="undefined")){p=n.form.find(".progressbar-description");p.append('<i class="icon16 exclamation"></i><p>'+r.warning+"</p>")}var q=v;var u=x;n.ajax_pull[u].push(setTimeout(function(){$.ajax({url:q,data:{processId:u},dataType:"json",type:"post",success:function(a){n.progressHandler(v,a?a.processId||u:u,a)},error:function(){n.progressHandler(v,u,null)}})},1000))}}}}});